[![badge](https://img.shields.io/badge/analyse%20cascades%20online%20(no%20setup)-csaransh%20+%20binder-E66581.svg?logo=data:image/png;base64,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)](https://mybinder.org/v2/gh/haptork/AnuVikar/main?filepath=examples%2Fcascades-db_cascadesWithMetaFile.ipynb)

![Build](https://github.com/haptork/AnuVikar/actions/workflows/cmake.yml/badge.svg)

[![Run on Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/drive/1PmXmoPo7_hGqTK62serwlx4hdksCuGQO) (prefer [binder](https://mybinder.org/v2/gh/haptork/AnuVikar/main?filepath=examples%2Fcascades-db_cascadesWithMetaFile.ipynb) for inline webapp)

AnuVikar
==================================

# Anuvikar : Analysis and Validation

The software uses gcc

### Dependencies and Requirements:

- gcc 5.3 or later or equivalent c++14 compiler.
- cmake
- Python 3.x or Python 2.7 or above, can be added with miniconda or conda.

### Building C++:

1. Go to anuvikar directory.
2. Make a new directory `_build`. 
3. Go to this directory and run `cmake ..` and then `cmake --build .`

The executable `anuvikar` can be found in the `_build` directory. You can run the tests from the *anuvikar* directory by running the `anuvikar_test` application that gets built in the `_build` directory, the command would look like `./_build/anuvikar_test`.

### Python dependencies installation:

You will need to install required python packages to run it on your system. For that, 

1. Go to anuvikar directory.
2. run `conda env create -f environment.yml` and `conda activate csaransh` if you are using conda, or you can use `pip install -r requirements.txt`.

## Validating and Adding to CsaranshDB web-app

- Go to anuvikar directory.
- Switch to csaransh conda environment if using conda with: `conda activate csaransh`.

### Basic Validation:

#### Running avi_validate_cdb.py

- `python avi_validate_cdb.py $pathToXyzArchiveDir $pathToOutputDir ...pathToXmlMetafiles`.
- The first argument is a path to the directory that has arhived xyz files as downloaded / stored in CascadesDB. The directory can have many archives but only the ones that correspond to the metafiles given in argument three onwards will be analysed.
- The second argument is path to the output directory. Archives will be extracted to this directory. Also, the processed files `anuvikar.json`, `anuvikar.db` and `log.txt` will be stored here. Since the output files have same name, please take care that outputs are not overwritten by multiple runs.
- The third argument onwards can be multiple Xml metafiles to process. These can by given as `pathToMetaFileDir/*.xml`.
- This command may take some time, you can ignore the warnings and runtimewarnings on the output console. There can be errors like corrupt archive, unable to unzip etc. 
- Go through log.txt in the output directory. Search for errors and warnings. Files with errors are not analysed. These can be looked upon and discussed with the author before adding to Cdb.

#### Examples

- An example run command: `python avi_validate_cdb /data/W/newEntries/ /data/W/newEntries /data/W/newEntries/*xml`. Here we have archives and xml files in the same directory and we want output files to be written in the same directory.
- Another example run command: `python avi_validate_cdb /data/W/allArchives/ /data/W/newEntries /data/W/newEntries/*xml`. Here we have storing all the old and new archives in the same directory `allArchives`. Directory for new xml files and output files to be written are  the same.

### Adding to Database

- Run `python avi_add_cdb.py $new_output_dir $destination_db_path $existing_database_path`:
- First argument: Provide the output directory of the `avi_validate_cdb.py` which has `anuvikar.json` and `anuvikar.db` files for the cascades that you wish to add to the database.
- Second argument: File path for the output db.
- Third argument: File path for the existing db if exists.
- The destination db path (second argument) is the database file that can be copied to `$csaransh_dir$/src/db/dev.csaransh.db` to view the updated database.
- The command generates another file which is `destination_db_path+_tree.pickle` which needs to be kept with the db file. This will be used by avi_add_cdb.py while further adding more data (when passing this new db as the third argument).

#### Examples and Use Cases

1. Fresh database:

- Run avi_validate_cdb for the archives and corrensponding meta files. Provide the output directory of this command to avi_add_cdb. For example:
  - `python avi_validate_cdb /data/W/newEntries/ /data/W/newEntries /data/W/newEntries/*xml`
  - `python avi_add_cdb /data/W/newEntries/ /data/W/newEntries/csaransh.db`
  - `cp /data/W/newEntries/csaransh.db ./src/db/dev.csaransh.db`
  - Now you can open the webpage (directions given later in this readme) to view your new entries on csaransh-webapp.

2. Adding new data to the earlier processed db:

  - Let us say that you want to add new data to the db we created in the last step.
  - `python avi_validate_cdb /data/W/newerEntries/ /data/W/newerEntries /data/W/newerEntries/*xml`
  - `python avi_add_cdb /data/W/newerData/ /data/W/newerData/csaransh.db /data/W/newEntries/csaransh.db`
  - `cp /data/W/newerEntries/csaransh.db ./src/db/dev.csaransh.db`
  - Now you can open the webpage (directions given later in this readme) to view your newer entries along with the new entries added earlier.

## Features

- One line to get all the cascade results in a python variable `isSuccess, cascades = queryCdbToProcess(dataDir, config, material="W", energyRange=[2, 3], tempRange=["", 1500])` which is ready to be explored with python or opened in interactive web-app loaded with interactive plots.
![drawing](docs/csaransh4py.gif)
*Starting from selecting cascades of interest based on different criterion (energy range, temperature, author etc.), to download, processing, visualizations, to statistics based on different grouping, it is all automated.*

- Web-app with loads of features to explore the data.
![drawing](docs/csaransh4table.gif)
*A feature loaded table view with column selection, multi-sort, reflective filters that provide a way to query the data quickly. If you select a filter, other filters reflect the options left.*

![drawing](docs/csaransh4stats.gif)
*Quickly view and compare the statistics of different parameters such as defects count, cascade volume etc. split on any combination of input fields such as grouped by energy & elements, temperature, potential etc.*



## Related Articles, Citation & Acknowledgements

You can check the web page for the project ([link](https://haptork.github.io/csaransh/)) and read the [manual](https://github.com/haptork/csaransh#getting-started) to go through the different sections. The web page shows the results for the MD [database of IAEA Challenge on Materials for Fusion 2018](https://www-amdis.iaea.org/CDB/challenge/).

Publications and Talks:

- _SaVi_ defect morphology algorithm: [paper](https://www.sciencedirect.com/science/article/abs/pii/S0927025621001993)
- Potential comparison based on morphology using _SaVi_: [paper](https://doi.org/10.1088/1361-651X/ac095d)
- [MoD-PMI 2021](https://www.fz-juelich.de/conferences/PFMC-18/EN/MoD-PMI-2021/artikel.html) talk on _SaVi_ algorithm and its applications [presentation](https://haptork.github.io/csaransh/presentation/savi.html)
- Unsupervised morphology classification and searching similar defects: [paper](https://doi.org/10.1016/j.commatsci.2019.109364)
- [MoD-PMI 2019](http://dpc.nifs.ac.jp/dkato/MoD-PMI2019/) talk on  defect identification algorithm used and classification of clusters [presentation](https://haptork.github.io/csaransh/presentation/index.html).
- For citation of Csaransh use [JOSS paper](http://joss.theoj.org/papers/72f2ddde2112497826753319956ea8ab).

The initial version was submitted to the
[IAEA Challenge on Materials for Fusion 2018](https://challenge.iaea.org/challenges/2018-NA-Mat-Fusion) as an
entry from [Bhabha Atomic Research Center (BARC)](http://www.barc.gov.in) by Utkarsh Bhardwaj, Ashok Arya, Harsh Hemani, Nancy Semwal and Manoj Warrier. Many thanks to the team, the challenge organizers and the judges for their encouraging words.

